---
title: "Спец. поставщик"
permalink: /docs/customers/spec_supplier/
toc: true
---

# Как работает инструмент "Спец.поставщик"

Используется для создания видимости корректного перевыставления услуги от поставщика.

#### Кнопка
* Расположена на тулбаре вкладки "Расходы" в отчете по перевозке
* Название кнопки: "Спецпоставщик"
* Доступна только для роли "BR - Доступ к работе со спец.услугой"

#### Выборка данных для расчета
Берем строки из вкладки "Расходы" по следующим критериям:
* У строки расхода есть ссылка на услугу из калькуляции для клиента - перевыставлена
* У строки расхода в группе "Документ поставщика" поле "Готов" должно быть пустым
* У строки расхода сумма из колонки "Деньги (предварительные)" -> "Всего (Валюта учета)" не должна быть пустой

**Если в выборку попадают 2 и более строк с одинаковой операцией - выводим ошибку пользователю.**

#### Создание нового расхода
Сравнивается предварительную сумму у расхода с суммой клиенту
* Если суммы равны - ничего не происходит
* Если сумма для клиента > сумма в расходе, то:
  1. Создаем новый отрицательный расход на разницу между суммой клиенту и суммой расхода с операцией, как в выбранном расходе и услугой с галкой "Спецуслуга". Ссылку на строку клиента не ставится.
  2. Сумму в расходе для анализируемой строки приравниваем сумме из строки клиента.
